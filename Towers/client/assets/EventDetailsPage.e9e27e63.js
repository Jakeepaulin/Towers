import{i as u,A as s,_ as Y,j as q,w as z,b as F,d as y,P as c,k as P,l as R,T as W,C as L,c as l,a as n,t as _,m as f,n as O,F as V,r as G,q as M,s as H,v as J,u as K,x as Q,o as r,f as N,p as X,g as Z,h as U}from"./index.c454215b.js";class ${async getTicketsByEventId(e){const a=await u.get(`api/events/${e}/tickets`);s.tickets=a.data}async removeTicket(e){await u.delete(`api/tickets/${e}`),s.tickets=s.tickets.filter(a=>a.id!=e)}async addTicket(e){const t=(await u.post("api/tickets",e)).data.profile;s.tickets.push(t),this.getTicketsByEventId()}}const p=new $;class ee{constructor(e){this.id=e.id,this.creatorId=e.creatorId,this.eventId=e.eventId,this.body=e.body,this.isAttending=e.isAttending}}class te{async getCommentsByEventId(e){const a=await u.get(`api/events/${e}/comments`);s.comments=a.data}async createComment(e){const a=await u.post("api/comments",e),t=new ee(a.data);s.comments.push(t)}async removeComment(e){await u.delete(`api/comments/${e}`),s.comments=s.comments.filter(a=>a.id!=e)}}const k=new te;const ne={setup(){const i=q({comments:{}});z(()=>{i.value={...s.post}});const e=K();async function a(){try{await P.getEventsById(e.params.id)}catch(o){c.error(o,"[GetEvent]")}}async function t(){try{await p.getTicketsByEventId(e.params.id)}catch(o){c.error(o,"[GetTickets]")}}async function g(){try{await k.getCommentsByEventId(e.params.id)}catch(o){c.error(o,"[GetComments]")}}return F(()=>{a(),t(),g()}),{editable:i,account:y(()=>s.account),comments:y(()=>s.comments),events:y(()=>s.events),event:y(()=>s.activeEvent),tickets:y(()=>s.tickets),isAttending:y(()=>s.tickets.find(o=>o.accountId==s.account.id)),async cancelEvent(){try{if(!await c.confirm("Are you sure you want to Cancel this event?"))return;const m=s.activeEvent;await P.cancelEvent(m.id),c.success("You are no longer attending this event")}catch(o){c.error(o)}},async addTicket(){try{if(!s.account.id)return R.loginWithRedirect();await p.addTicket({eventId:s.activeEvent.id||e.params.id}),c.success("Thanks for coming to our event!")}catch(o){c.error(o)}},async removeTicket(){try{if(!await c.confirm("Are you sure you want to Un-Attend this event?"))return;const m=s.tickets.find(v=>v.accountId==s.account.id&&v.eventId==s.activeEvent.id);await p.removeTicket(m.id),c.success("You are no longer attending this event")}catch(o){c.error(o)}},async createComment(){try{i.value.eventId=e.params.id,await k.createComment(i.value)}catch(o){c.error(o)}},async removeComment(){try{if(!await c.confirm("Are you sure you want to delete your comment?"))return;const m=s.comments.find(v=>v.creatorId==s.account.id&&v.eventId==s.activeEvent.id);await k.removeComment(m.id),c.success("Your Comment has been removed")}catch(o){c.error(o)}}}},components:{Ticket:W,Comment:L}},h=i=>(X("data-v-b35a45cd"),i=i(),Z(),i),se={class:"container-fluid"},oe={class:"col-md-12 opaque rounded"},ce={class:"row py-3"},ae={class:"col-md-5 d-flex align-text-center"},ie=["src"],re={key:0,class:"col-md-7 d-flex flex-wrap justify-content-between"},de={class:"col-md-12"},le={class:"d-flex justify-content-between"},me={class:"mt-5 col-md-12"},ve={class:"col-md-12 d-flex justify-content-between pe-2"},ye=Q(" Spots left: "),ue={class:"text-success"},_e={key:0,class:"col-md-12 d-flex align-content-bottom"},he=h(()=>n("h4",{class:"text-danger"},"This Event is Sold Out",-1)),fe=[he],pe={key:1,class:"col-md-7 d-flex justify-content-center align-content-center text-danger"},ke=h(()=>n("h3",{class:"pt-3"}," This event has been canceled... sorry ",-1)),ge=[ke],be={class:"row"},we={class:"col-12 d-flex flex-direction-row gap-3"},Ce={class:"row"},xe=h(()=>n("label",{class:"py-2",for:"body"},"Comment:",-1)),Ie=h(()=>n("div",{class:"col-12 d-flex justify-content-end py-2"},[n("button",{type:"submit",class:"btn btn-info text-end"}," Add Comment")],-1)),Ee=h(()=>n("h6",null,"What people are saying:",-1)),Te={class:"col-md-12 bg-secondary my-2 rounded"},Ae={class:"col-md-12 d-flex justify-content-between align-items-center my-3 bg-light rounded"};function Se(i,e,a,t,g,o){var b,w,C,x,I,E,T,A,S,B,j,D;const m=U("Ticket"),v=U("Comment");return r(),l("div",se,[n("div",{class:"row p-0 backdrop rounded mt-4",style:O({backgroundImage:`url(${(b=t.event)==null?void 0:b.coverImg})`})},[n("div",oe,[n("div",ce,[n("div",ae,[n("img",{src:(w=t.event)==null?void 0:w.coverImg,alt:"",class:"mini-pic rounded"},null,8,ie)]),((C=t.event)==null?void 0:C.isCanceled)==!1?(r(),l("div",re,[n("div",de,[n("div",le,[n("h3",null,_((x=t.event)==null?void 0:x.name),1),((I=t.event)==null?void 0:I.creatorId)==((E=t.account)==null?void 0:E.id)?(r(),l("button",{key:0,onClick:e[0]||(e[0]=d=>t.cancelEvent()),class:"btn btn-danger pe-3"}," Cancel Event ")):f("",!0)]),n("h6",null,_((T=t.event)==null?void 0:T.location),1),n("h6",null,_((A=t.event)==null?void 0:A.startDate),1)]),n("div",me,[n("p",null,_((S=t.event)==null?void 0:S.description),1)]),n("div",ve,[n("p",null,[ye,n("div",ue,_((B=t.event)==null?void 0:B.capacity),1)]),!t.isAttending&&((j=t.event)==null?void 0:j.capacity)>0?(r(),l("button",{key:0,onClick:e[1]||(e[1]=d=>t.addTicket()),class:"btn btn-warning pe-3"}," Attend ")):t.isAttending?(r(),l("button",{key:1,onClick:e[2]||(e[2]=d=>t.removeTicket()),class:"btn btn-danger pe-3"}," Un-Attend ")):f("",!0)]),((D=t.event)==null?void 0:D.capacity)<=0?(r(),l("div",_e,fe)):f("",!0)])):(r(),l("div",pe,ge))])])],4),n("div",be,[n("div",we,[(r(!0),l(V,null,G(t.tickets,d=>(r(),N(m,{key:d.id,ticket:d},null,8,["ticket"]))),128))])]),n("div",Ce,[n("div",null,[n("form",{action:"submit",onSubmit:e[4]||(e[4]=M(d=>t.createComment(),["prevent"]))},[xe,H(n("textarea",{type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=d=>t.editable.body=d),name:"body",rows:"4",style:{resize:"none"}},`
        `,512),[[J,t.editable.body]]),Ie],32)]),Ee,n("div",Te,[(r(!0),l(V,null,G(t.comments,d=>(r(),l("div",Ae,[(r(),N(v,{key:d.id,comment:d,class:"p-3"},null,8,["comment"])),n("i",{class:"mdi mdi-delete selectable text-danger rounded text-end px-3",onClick:e[5]||(e[5]=M(Be=>t.removeComment(t.comments.id),["stop"]))})]))),256))])])])}const De=Y(ne,[["render",Se],["__scopeId","data-v-b35a45cd"]]);export{De as default};
